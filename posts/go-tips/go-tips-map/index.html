<!DOCTYPE html>
<html lang="zh-cn">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="zh-cn">
    <meta name="color-scheme" content="light dark">

    
      <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;">

    

    <meta name="author" content="行百里者半九十">
    <meta name="description" content="Tip1 初始化方式    func TestTestInitMap(t *testing.T) { // 方法一（字面量初始化） 	m1 := map[string]int{&#34;Go&#34;: 1, &#34;Java&#34;: 2, &#34;Python&#34;: 3} m2 := map[int]int{} // 方法二（使用内置函数make初始化） 	m3 := make(map[int]int, 10) // 使用len函数打印map的长度, 不能用cap打印容量 	t.Logf(&#34;len m1=%d&#34;, len(m1)) m2[4] = 16 t.Logf(&#34;len m2=%d&#34;, len(m2)) t.Logf(&#34;len m3=%d&#34;, len(m3)) } 以上两者同样是初始化一个Map，有什么不同？
 方法二提前分配了Map的容量，减少内存分配的次数，相比方法一而言性能更好，但是可扩展性更差。  Tip2 增删查改（Create、Delete、Read、Update）    func TestMapCRUD(t *testing.T) { m := make(map[string]int, 10) m[&#34;other&#34;] = 0 // Create 	m[&#34;go&#34;] = 1 t.">
    <meta name="keywords" content="blog,developer,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go Tips | Map"/>
<meta name="twitter:description" content="Tip1 初始化方式    func TestTestInitMap(t *testing.T) { // 方法一（字面量初始化） 	m1 := map[string]int{&#34;Go&#34;: 1, &#34;Java&#34;: 2, &#34;Python&#34;: 3} m2 := map[int]int{} // 方法二（使用内置函数make初始化） 	m3 := make(map[int]int, 10) // 使用len函数打印map的长度, 不能用cap打印容量 	t.Logf(&#34;len m1=%d&#34;, len(m1)) m2[4] = 16 t.Logf(&#34;len m2=%d&#34;, len(m2)) t.Logf(&#34;len m3=%d&#34;, len(m3)) } 以上两者同样是初始化一个Map，有什么不同？
 方法二提前分配了Map的容量，减少内存分配的次数，相比方法一而言性能更好，但是可扩展性更差。  Tip2 增删查改（Create、Delete、Read、Update）    func TestMapCRUD(t *testing.T) { m := make(map[string]int, 10) m[&#34;other&#34;] = 0 // Create 	m[&#34;go&#34;] = 1 t."/>

    <meta property="og:title" content="Go Tips | Map" />
<meta property="og:description" content="Tip1 初始化方式    func TestTestInitMap(t *testing.T) { // 方法一（字面量初始化） 	m1 := map[string]int{&#34;Go&#34;: 1, &#34;Java&#34;: 2, &#34;Python&#34;: 3} m2 := map[int]int{} // 方法二（使用内置函数make初始化） 	m3 := make(map[int]int, 10) // 使用len函数打印map的长度, 不能用cap打印容量 	t.Logf(&#34;len m1=%d&#34;, len(m1)) m2[4] = 16 t.Logf(&#34;len m2=%d&#34;, len(m2)) t.Logf(&#34;len m3=%d&#34;, len(m3)) } 以上两者同样是初始化一个Map，有什么不同？
 方法二提前分配了Map的容量，减少内存分配的次数，相比方法一而言性能更好，但是可扩展性更差。  Tip2 增删查改（Create、Delete、Read、Update）    func TestMapCRUD(t *testing.T) { m := make(map[string]int, 10) m[&#34;other&#34;] = 0 // Create 	m[&#34;go&#34;] = 1 t." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xblzbjs.cn/posts/go-tips/go-tips-map/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-25T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2021-05-25T00:00:00&#43;00:00" />
<meta property="og:see_also" content="https://xblzbjs.cn/posts/go-tips/go-tips-test/" />



    <title>
  Go Tips | Map · 行百里者半九十
</title>

    
      <link rel="canonical" href="https://xblzbjs.cn/posts/go-tips/go-tips-map/">
    

    <link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>

    
      
      
      <link rel="stylesheet" href="/css/coder.min.93c41bf1e522f85ecda7355985f09000f71fc1d64dda9f74051b0fa06210e93f.css" integrity="sha256-k8Qb8eUi&#43;F7NpzVZhfCQAPcfwdZN2p90BRsPoGIQ6T8=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="/css/coder-dark.min.f37febc669ce189201c1918fac1948a254686c8d366a312c2d72b2bb71ad97d1.css" integrity="sha256-83/rxmnOGJIBwZGPrBlIolRobI02ajEsLXKyu3Gtl9E=" crossorigin="anonymous" media="screen" />
      
    

    

    

    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

    

    <meta name="generator" content="Hugo 0.83.1" />
  </head>

  
  
    
  
  <body class="preload-transitions colorscheme-auto"
        onload=""
  >
    
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      行百里者半九十
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts/">随笔</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/archive/">归档</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/about/">关于</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/learning-materials/">学习资料</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://xblzbjs.cn/posts/go-tips/go-tips-map/">
              Go Tips | Map
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime='2021-05-25T00:00:00Z'>
                May 25, 2021
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              阅读时间：3 分钟
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/go/">go</a>
    </span></div>

        </div>
      </header>

      <div>
        
        <h2 id="tip1-初始化方式">
  Tip1 初始化方式
  <a class="heading-link" href="#tip1-%e5%88%9d%e5%a7%8b%e5%8c%96%e6%96%b9%e5%bc%8f">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<div class="highlight"><pre style="color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#0087ff">func</span> <span style="color:#0087ff">TestTestInitMap</span>(t *testing.T) {
	<span style="color:#4e4e4e">// 方法一（字面量初始化）
</span><span style="color:#4e4e4e"></span>	m1 := <span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">int</span>{<span style="color:#00afaf">&#34;Go&#34;</span>: <span style="color:#00afaf">1</span>, <span style="color:#00afaf">&#34;Java&#34;</span>: <span style="color:#00afaf">2</span>, <span style="color:#00afaf">&#34;Python&#34;</span>: <span style="color:#00afaf">3</span>}
	m2 := <span style="color:#0087ff">map</span>[<span style="color:#af0000">int</span>]<span style="color:#af0000">int</span>{}
	<span style="color:#4e4e4e">// 方法二（使用内置函数make初始化）
</span><span style="color:#4e4e4e"></span>	m3 := <span style="color:#0087ff">make</span>(<span style="color:#0087ff">map</span>[<span style="color:#af0000">int</span>]<span style="color:#af0000">int</span>, <span style="color:#00afaf">10</span>)
	<span style="color:#4e4e4e">// 使用len函数打印map的长度, 不能用cap打印容量
</span><span style="color:#4e4e4e"></span>	t.<span style="color:#0087ff">Logf</span>(<span style="color:#00afaf">&#34;len m1=%d&#34;</span>, <span style="color:#0087ff">len</span>(m1))
	m2[<span style="color:#00afaf">4</span>] = <span style="color:#00afaf">16</span>
	t.<span style="color:#0087ff">Logf</span>(<span style="color:#00afaf">&#34;len m2=%d&#34;</span>, <span style="color:#0087ff">len</span>(m2))
	t.<span style="color:#0087ff">Logf</span>(<span style="color:#00afaf">&#34;len m3=%d&#34;</span>, <span style="color:#0087ff">len</span>(m3)) 
}
</code></pre></div><p>以上两者同样是初始化一个Map，有什么不同？</p>
<ul>
<li>方法二提前分配了Map的容量，减少内存分配的次数，相比方法一而言性能更好，但是可扩展性更差。</li>
</ul>
<h2 id="tip2-增删查改createdeletereadupdate">
  Tip2 增删查改（Create、Delete、Read、Update）
  <a class="heading-link" href="#tip2-%e5%a2%9e%e5%88%a0%e6%9f%a5%e6%94%b9createdeletereadupdate">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<div class="highlight"><pre style="color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#0087ff">func</span> <span style="color:#0087ff">TestMapCRUD</span>(t *testing.T) {
	m := <span style="color:#0087ff">make</span>(<span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">int</span>, <span style="color:#00afaf">10</span>)
	m[<span style="color:#00afaf">&#34;other&#34;</span>] = <span style="color:#00afaf">0</span>
	<span style="color:#4e4e4e">// Create
</span><span style="color:#4e4e4e"></span>	m[<span style="color:#00afaf">&#34;go&#34;</span>] = <span style="color:#00afaf">1</span>
	t.<span style="color:#0087ff">Logf</span>(<span style="color:#00afaf">&#34;Before updating:%d&#34;</span>, m[<span style="color:#00afaf">&#34;go&#34;</span>])
	<span style="color:#4e4e4e">// Update
</span><span style="color:#4e4e4e"></span>	m[<span style="color:#00afaf">&#34;go&#34;</span>] = <span style="color:#00afaf">100</span>
	t.<span style="color:#0087ff">Logf</span>(<span style="color:#00afaf">&#34;After updating:%d&#34;</span>, m[<span style="color:#00afaf">&#34;go&#34;</span>])
	<span style="color:#4e4e4e">// Delete
</span><span style="color:#4e4e4e"></span>	<span style="color:#0087ff">delete</span>(m, <span style="color:#00afaf">&#34;go&#34;</span>)
	<span style="color:#4e4e4e">// Read
</span><span style="color:#4e4e4e"></span>	val, exist := m[<span style="color:#00afaf">&#34;go&#34;</span>]
	<span style="color:#5f8700">if</span> exist {
		t.<span style="color:#0087ff">Logf</span>(<span style="color:#00afaf">&#34;Exist! Value is %d&#34;</span>, val)
	} <span style="color:#5f8700">else</span> {
		t.<span style="color:#0087ff">Log</span>(<span style="color:#00afaf">&#34;Does not exist!&#34;</span>)
	}
}

<span style="color:#0087ff">func</span> <span style="color:#0087ff">TestEmptyMap</span>(t *testing.T) {
	<span style="color:#0087ff">var</span> m <span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">int</span>
	m[<span style="color:#00afaf">&#34;string&#34;</span>] = <span style="color:#00afaf">3</span>	<span style="color:#4e4e4e">//会触发panic: assignment to entry in nil map
</span><span style="color:#4e4e4e"></span>}
</code></pre></div><p>注意：</p>
<ul>
<li>如果map为nil或者指定key不存在时，delete()不会报错，相当于空操作</li>
<li>查询、修改键时，检查键是否存在。否则查询会操作零值，修改会创建新的键值对</li>
<li><strong>未初始化的map值为nil，向值为nil的map添加元素时会出发panic</strong></li>
</ul>
<h2 id="tip3-遍历输出map的key与value">
  Tip3 遍历输出Map的key与value
  <a class="heading-link" href="#tip3-%e9%81%8d%e5%8e%86%e8%be%93%e5%87%bamap%e7%9a%84key%e4%b8%8evalue">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<div class="highlight"><pre style="color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#0087ff">func</span> <span style="color:#0087ff">TestTravelMap</span>(t *testing.T) {
	m1 := <span style="color:#0087ff">map</span>[<span style="color:#af0000">int</span>]<span style="color:#af0000">int</span>{<span style="color:#00afaf">1</span>: <span style="color:#00afaf">1</span>, <span style="color:#00afaf">2</span>: <span style="color:#00afaf">4</span>, <span style="color:#00afaf">3</span>: <span style="color:#00afaf">9</span>}
	<span style="color:#5f8700">for</span> k, v := <span style="color:#5f8700">range</span> m1 {
		t.<span style="color:#0087ff">Log</span>(k, v)
	}
}
</code></pre></div><h2 id="tip4--new和make创建map的差异">
  Tip4  <code>new</code>和<code>make</code>创建Map的差异
  <a class="heading-link" href="#tip4--new%e5%92%8cmake%e5%88%9b%e5%bb%bamap%e7%9a%84%e5%b7%ae%e5%bc%82">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>使用new来创建map时，返回的内容是一个<strong>指针</strong>，这个指针指向了一个所有字段全为0的值map对象，<strong>需要初始化</strong>后才能使用，而使用make来创建map时，返回的内容是一个<strong>引用</strong>，可以<strong>直接使用</strong>。</p>
<h3 id="例子">
  例子
  <a class="heading-link" href="#%e4%be%8b%e5%ad%90">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre style="color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#0087ff">func</span> <span style="color:#0087ff">TestDiffMakeAndNew</span>(t *testing.T) {
	t.<span style="color:#0087ff">Log</span>(<span style="color:#00afaf">&#34;========使用new创建Map=======&#34;</span>)
	m := <span style="color:#0087ff">new</span>(<span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">int</span>)
	t.<span style="color:#0087ff">Log</span>(m, <span style="color:#00afaf">&#34;\t&#34;</span>, reflect.<span style="color:#0087ff">TypeOf</span>(m))
	t.<span style="color:#0087ff">Log</span>(&amp;m, <span style="color:#00afaf">&#34;\t&#34;</span>, reflect.<span style="color:#0087ff">TypeOf</span>(&amp;m))
	t.<span style="color:#0087ff">Log</span>(*m, <span style="color:#00afaf">&#34;\t&#34;</span>, reflect.<span style="color:#0087ff">TypeOf</span>(*m))
	*m = <span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">int</span>{}
	t.<span style="color:#0087ff">Log</span>(*m, <span style="color:#00afaf">&#34;\t&#34;</span>, reflect.<span style="color:#0087ff">TypeOf</span>(*m))
	(*m)[<span style="color:#00afaf">&#34;a&#34;</span>] = <span style="color:#00afaf">44</span>
	t.<span style="color:#0087ff">Log</span>(*m, <span style="color:#00afaf">&#34;\t&#34;</span>, reflect.<span style="color:#0087ff">TypeOf</span>((*m)[<span style="color:#00afaf">&#34;a&#34;</span>]))

	t.<span style="color:#0087ff">Log</span>(<span style="color:#00afaf">&#34;========使用make创建Map=======&#34;</span>)
	*m = <span style="color:#0087ff">make</span>(<span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">int</span>, <span style="color:#00afaf">0</span>)
	t.<span style="color:#0087ff">Log</span>(*m, <span style="color:#00afaf">&#34;\t&#34;</span>, reflect.<span style="color:#0087ff">TypeOf</span>(*m))
	(*m)[<span style="color:#00afaf">&#34;b&#34;</span>] = <span style="color:#00afaf">55</span>
	t.<span style="color:#0087ff">Log</span>(*m, <span style="color:#00afaf">&#34;\t&#34;</span>, <span style="color:#0087ff">len</span>(*m))

	t.<span style="color:#0087ff">Log</span>(<span style="color:#00afaf">&#34;========性能差异=======&#34;</span>)
	<span style="color:#0087ff">makeMapTime</span>()
	<span style="color:#0087ff">newMapTime</span>()
}

</code></pre></div><h3 id="运行结果">
  运行结果
  <a class="heading-link" href="#%e8%bf%90%e8%a1%8c%e7%bb%93%e6%9e%9c">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre style="color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">=== RUN   TestDiffMakeAndNew
    map_test.<span style="color:#5f8700">go</span>:<span style="color:#00afaf">43</span>: ========使用new创建Map=======
    map_test.<span style="color:#5f8700">go</span>:<span style="color:#00afaf">45</span>: &amp;<span style="color:#0087ff">map</span>[] 	 *<span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">int</span>
    map_test.<span style="color:#5f8700">go</span>:<span style="color:#00afaf">46</span>: <span style="color:#00afaf">0xc00000e038</span> 	 **<span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">int</span>
    map_test.<span style="color:#5f8700">go</span>:<span style="color:#00afaf">47</span>: <span style="color:#0087ff">map</span>[] 	 <span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">int</span>
    map_test.<span style="color:#5f8700">go</span>:<span style="color:#00afaf">49</span>: <span style="color:#0087ff">map</span>[] 	 <span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">int</span>
    map_test.<span style="color:#5f8700">go</span>:<span style="color:#00afaf">51</span>: <span style="color:#0087ff">map</span>[a:<span style="color:#00afaf">44</span>] 	 <span style="color:#af0000">int</span>
    map_test.<span style="color:#5f8700">go</span>:<span style="color:#00afaf">53</span>: ========使用make创建Map=======
    map_test.<span style="color:#5f8700">go</span>:<span style="color:#00afaf">55</span>: <span style="color:#0087ff">map</span>[] 	 <span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">int</span>
    map_test.<span style="color:#5f8700">go</span>:<span style="color:#00afaf">57</span>: <span style="color:#0087ff">map</span>[b:<span style="color:#00afaf">55</span>] 	 <span style="color:#00afaf">1</span>
    map_test.<span style="color:#5f8700">go</span>:<span style="color:#00afaf">59</span>: ========性能差异=======
	使用make函数执行完成耗时： <span style="color:#00afaf">4.940985678</span>s
	使用new函数执行完成耗时： <span style="color:#00afaf">4.796069742</span>s
--- PASS: <span style="color:#0087ff">TestDiffMakeAndNew</span> (<span style="color:#00afaf">9.74</span>s)
</code></pre></div><h3 id="辅助函数">
  辅助函数
  <a class="heading-link" href="#%e8%be%85%e5%8a%a9%e5%87%bd%e6%95%b0">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<div class="highlight"><pre style="color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#4e4e4e">// newMapTime
</span><span style="color:#4e4e4e"></span><span style="color:#0087ff">func</span> <span style="color:#0087ff">newMapTime</span>() {
	m := <span style="color:#0087ff">new</span>(<span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">int</span>)
	*m = <span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">int</span>{}
	start := time.<span style="color:#0087ff">Now</span>() <span style="color:#4e4e4e">// 获取当前时间
</span><span style="color:#4e4e4e"></span>	<span style="color:#5f8700">for</span> i := <span style="color:#00afaf">0</span>; i &lt; <span style="color:#00afaf">10000000</span>; i++ {
		(*m)[strconv.<span style="color:#0087ff">Itoa</span>(i)] = i
	}
	elapsed := time.<span style="color:#0087ff">Now</span>().<span style="color:#0087ff">Sub</span>(start)
	fmt.<span style="color:#0087ff">Println</span>(<span style="color:#00afaf">&#34;\t使用new函数执行完成耗时：&#34;</span>, elapsed)
}

<span style="color:#4e4e4e">// makeMapTime
</span><span style="color:#4e4e4e"></span><span style="color:#0087ff">func</span> <span style="color:#0087ff">makeMapTime</span>() {
	m := <span style="color:#0087ff">make</span>(<span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">int</span>)
	start := time.<span style="color:#0087ff">Now</span>() <span style="color:#4e4e4e">// 获取当前时间
</span><span style="color:#4e4e4e"></span>	<span style="color:#5f8700">for</span> i := <span style="color:#00afaf">0</span>; i &lt; <span style="color:#00afaf">10000000</span>; i++ {
		m[strconv.<span style="color:#0087ff">Itoa</span>(i)] = i
	}
	elapsed := time.<span style="color:#0087ff">Now</span>().<span style="color:#0087ff">Sub</span>(start)
	fmt.<span style="color:#0087ff">Println</span>(<span style="color:#00afaf">&#34;\t使用make函数执行完成耗时：&#34;</span>, elapsed)
}
</code></pre></div><h2 id="tip-5-应该优先考虑哪些类型作为map的key">
  Tip 5 应该优先考虑哪些类型作为Map的key？
  <a class="heading-link" href="#tip-5-%e5%ba%94%e8%af%a5%e4%bc%98%e5%85%88%e8%80%83%e8%99%91%e5%93%aa%e4%ba%9b%e7%b1%bb%e5%9e%8b%e4%bd%9c%e4%b8%bamap%e7%9a%84key">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>先说结论：优先选用<strong>数值类型和指针类型</strong>。如果非要选择<strong>字符串类型的话，最好对键值的长度进行额外的约束。</strong></p>
<p>只从性能上看的话，<strong>求哈希和判等操作的速度越快，对应的类型就越适合作为键类型。</strong></p>
<p>所有的基本类型、指针类型，以及数组类型、结构体类型和接口类型，Go 语言都有一套算法与之对应，其中就包含了哈希和判等。以求哈希的操作为例，<strong>宽度</strong>越小的类型速度通常越快。<strong>宽度</strong>是指类型单个值需要占用的字节数。比如，bool、int8和uint8类型的一个值需要占用的字节数都是1，因此这些类型的宽度就都是1。</p>
<p>注意，最好不要用高级数据类型作为Map的key，不仅仅是因为对它们的值求哈希，以及判等的速度较慢，更是因为在它们的值中存在变数。比如，对一个数组来说，我可以任意改变其中的元素值，但在变化前后，它却代表了两个不同的键值。</p>
<h3 id="附录">
  附录
  <a class="heading-link" href="#%e9%99%84%e5%bd%95">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p><a href="https://golangbyexample.com/all-data-types-in-golang-with-examples/">All data types in Golang with examples</a></p>
<h2 id="tip6-map类型的value实现并发">
  Tip6 Map类型的Value实现并发
  <a class="heading-link" href="#tip6-map%e7%b1%bb%e5%9e%8b%e7%9a%84value%e5%ae%9e%e7%8e%b0%e5%b9%b6%e5%8f%91">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>由于map操作不是原子性的，所以多个携程同时操作map有可能产生读写冲突，会触发panic。Go团队在<a href="https://golang.org/doc/faq#atomic_maps">Why are map operations not defined to be atomic</a>对此进行了解释。</p>
<p>如果有需求可以参考第三方封装的concurrent map和Go1.9以后内置的<code>sync.Map</code></p>
<h3 id="syncmap使用场景">
  sync.Map使用场景
  <a class="heading-link" href="#syncmap%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<blockquote>
<p>The Map type is optimized for two common use cases:</p>
<ol>
<li>when the entry for a given key is only ever written once but read many times, as in caches that only grow.</li>
<li>when multiple goroutines read, write, and overwrite entries for disjoint sets of keys. In these two cases, use of a Map may <strong>significantly</strong> reduce lock contention compared to a Go map paired with a separate Mutex or RWMutex.</li>
</ol>
</blockquote>
<ul>
<li>写少读多的情况</li>
<li>多goroutine，读、写、复写 不同数据的情况</li>
<li>多核心情况使用</li>
</ul>
<h3 id="concurrentmap使用场景">
  Concurrent.map使用场景
  <a class="heading-link" href="#concurrentmap%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<ul>
<li>读写都相对频繁</li>
</ul>
<h3 id="附录-1">
  附录
  <a class="heading-link" href="#%e9%99%84%e5%bd%95-1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p><a href="https://github.com/orcaman/concurrent-map">concurrent map</a></p>
<h2 id="tip7-map的key不能是哪些类型">
  Tip7 Map的key不能是哪些类型
  <a class="heading-link" href="#tip7-map%e7%9a%84key%e4%b8%8d%e8%83%bd%e6%98%af%e5%93%aa%e4%ba%9b%e7%b1%bb%e5%9e%8b">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Go 语言规范规定，在键类型的值之间必须可以施加操作符==和!=。换句话说，键类型的值必须要支持判等操作。由于函数类型、字典类型和切片类型的值并不支持判等操作，所以字典的键类型不能是这些类型。</p>
<p>另外，如果键的类型是接口类型的，那么键值的实际类型也不能是上述三种类型，否则在程序运行过程中会引发 panic</p>
<h2 id="tip8-map与json相互转换">
  Tip8 Map与JSON相互转换
  <a class="heading-link" href="#tip8-map%e4%b8%8ejson%e7%9b%b8%e4%ba%92%e8%bd%ac%e6%8d%a2">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>我们经常会遇到JSON转换成Map或是Map转换为JSON的需求，这里推荐使用jsoniter替代原生的json包，其不仅支持原生的json，而且性能更快。</p>
<div class="highlight"><pre style="color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#d75f00">import</span> (
    ...
    jsoniter <span style="color:#00afaf">&#34;github.com/json-iterator/go&#34;</span>
)

<span style="color:#0087ff">var</span> json = jsoniter.ConfigCompatibleWithStandardLibrary


<span style="color:#4e4e4e">// JSONToMap return map and error
</span><span style="color:#4e4e4e"></span><span style="color:#0087ff">func</span> <span style="color:#0087ff">JSONToMap</span>(jsonStr <span style="color:#af0000">string</span>) (<span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">string</span>, <span style="color:#af0000">error</span>) {
	m := <span style="color:#0087ff">make</span>(<span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">string</span>)
	err := json.<span style="color:#0087ff">Unmarshal</span>([]<span style="color:#0087ff">byte</span>(jsonStr), &amp;m)
	<span style="color:#5f8700">if</span> err != <span style="color:#d75f00">nil</span> {
		fmt.<span style="color:#0087ff">Printf</span>(<span style="color:#00afaf">&#34;Unmarshal with error: %+v\n&#34;</span>, err)
		<span style="color:#5f8700">return</span> <span style="color:#d75f00">nil</span>, err
	}
	<span style="color:#5f8700">return</span> m, <span style="color:#d75f00">nil</span>
}

<span style="color:#4e4e4e">// MapToJSON return json string and error
</span><span style="color:#4e4e4e"></span><span style="color:#0087ff">func</span> <span style="color:#0087ff">MapToJSON</span>(m <span style="color:#0087ff">map</span>[<span style="color:#af0000">string</span>]<span style="color:#af0000">string</span>) (<span style="color:#af0000">string</span>, <span style="color:#af0000">error</span>) {
	jsonByte, err := json.<span style="color:#0087ff">Marshal</span>(m)
	<span style="color:#5f8700">if</span> err != <span style="color:#d75f00">nil</span> {
		fmt.<span style="color:#0087ff">Printf</span>(<span style="color:#00afaf">&#34;Marshal with error: %+v\n&#34;</span>, err)
		<span style="color:#5f8700">return</span> <span style="color:#00afaf">&#34;&#34;</span>, <span style="color:#d75f00">nil</span>
	}
	<span style="color:#5f8700">return</span> <span style="color:#0087ff">string</span>(jsonByte), <span style="color:#d75f00">nil</span>
}
</code></pre></div><h3 id="附录-2">
  附录:
  <a class="heading-link" href="#%e9%99%84%e5%bd%95-2">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p><a href="https://github.com/json-iterator/go">json-iterator</a></p>
<p><a href="https://jsoniter.com/benchmark.html">json性能对比</a></p>

      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3 id="参见-go-tips">
        参见 go-tips
        <a class="heading-link" href="#%e5%8f%82%e8%a7%81-go-tips">
          <i class="fa fa-link" aria-hidden="true"></i>
        </a>
      </h3>
      <nav>
        <ul>
        
        
          
        
          
            <li>
              <a href="/posts/go-tips/go-tips-test/">Go Tips | Test</a>
            </li>
          
        
        </ul>
      </nav>
    
  
</section>


        
        
        
      </footer>
    </article>

    
  </section>

      </div>

      

    </main>

    
      
      <script src="/js/coder.min.235666b114443867d43eeb5799d51f6252965e5163f338285e113fa381d3d27e.js" integrity="sha256-I1ZmsRREOGfUPutXmdUfYlKWXlFj8zgoXhE/o4HT0n4="></script>
    

    

    

    

    

    

    

    

    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-192697137-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-192697137-1');
</script>

  </body>

</html>
